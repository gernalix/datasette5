{% extends "default:table.html" %}

{% block extra_head %}
  {{ super() }}
  <style>
    /* Nascondi solo le opzioni di export (mai la sezione "Referenced by") */
    .export-options,
    .advanced-export,
    .download-links { display: none !important; }
  </style>
{% endblock %}

{% block extra_body %}
  {{ super() }}
  <script>
    (function () {
      // Applica solo alla tabella /output/calendar_range
      if (!/\/output\/calendar_range(\/|$)/.test(location.pathname)) return;

      // Nascondi SOLO il testo dell'SQL della view, senza rimuovere container/sezioni
      const hideSQL = () => {
        const rx = /CREATE\s+VIEW|AS\s+SELECT/i;
        document.querySelectorAll('pre, code').forEach(el => {
          const t = (el.textContent || "");
          if (rx.test(t)) el.style.display = 'none';
        });
        // Nascondi link "View and edit SQL" senza toccare altro
        Array.from(document.querySelectorAll('a, button')).forEach(el => {
          const txt = (el.textContent || '').trim().toLowerCase();
          if (txt === 'view and edit sql' || txt === 'view sql' || txt === 'sql') {
            el.style.display = 'none';
          }
        });
      };

      hideSQL();
      new MutationObserver(hideSQL).observe(document.body, { childList: true, subtree: true });
    })();
  </script>
{% endblock %}

{# Importante: lascia intatta la sezione "Referenced by" del template base #}
{% block referenced_by %}{{ super() }}{% endblock %}
