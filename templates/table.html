{% extends "default:table.html" %}

{% block extra_head %}
  {{ super() }}
  <style>
    /* Nascondi solo le opzioni di export (mai la sezione "Referenced by") */
    .export-options,
    .advanced-export,
    .download-links {
      display: none !important;
    }
  </style>
{% endblock %}

{% block extra_body %}
  {{ super() }}
  <script>
    (function () {
      function hideSQL() {
        // 1) Nascondi SOLO i blocchi di testo SQL (pre/code) che contengono la definizione di una view
        //    o una SELECT, senza rimuovere container interi
        var rx = /CREATE\s+VIEW|AS\s+SELECT/i;
        Array.prototype.forEach.call(
          document.querySelectorAll('pre, code'),
          function (el) {
            var txt = el.textContent || '';
            if (rx.test(txt)) {
              // Nascondi solo il blocco corrente
              el.style.display = 'none';
            }
          }
        );

        // 2) Nascondi SOLO i link / bottoni che mostrano esplicitamente la SQL
        Array.prototype.forEach.call(
          document.querySelectorAll('a, button'),
          function (el) {
            var txt = (el.textContent || '').trim().toLowerCase();
            if (txt === 'view and edit sql' || txt === 'view sql' || txt === 'sql') {
              el.style.display = 'none';
            }
          }
        );

        // Importante: NON tocchiamo altre sezioni/box sotto la tabella,
        // in particolare quelle che Datasette usa per i backlink
        // ("Links from other tables" / "Referenced by").
      }

      hideSQL();
      new MutationObserver(hideSQL).observe(document.body, {
        childList: true,
        subtree: true
      });
    })();
  </script>
{% endblock %}

{# Importante: lascia intatta la sezione "Referenced by" del template base #}
{% block referenced_by %}{{ super() }}{% endblock %}
